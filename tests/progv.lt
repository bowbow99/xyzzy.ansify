;;; -*- mode: lisp; package: cl.test.progv -*-
;;;
;;; test/progv.lt
;;;

(defpackage :cl.test.progv)
(in-package :cl.test.progv)

(require "cl")
(cl::install)

(require "lisp-unit")
(use-package :lisp-unit)

(remove-all-tests)

(define-test progv
  (setq x :global)

  (assert-eql 2 (progv '(x) '(2) x))

  (assert-equal
      '(3 4)
      (let ((x 3))
        (progv '(x) '(4)
          (list x (symbol-value 'x)))))

  (assert-eql :global x)

  (defparameter *var* :global)
  (assert-equal
      '(:let :let)
      (progv '(*var*) '(:progv)
        (let ((*var* :let))
          (list *var* (symbol-value '*var*)))))
  (assert-eql *var* :global)

  (setf foo :global)
  (defun foo-value () foo)
  (assert-eql :progv
      (progv '(foo) '(:progv) (foo-value)))
  (let ((foo :let))
    (assert-eql :progv
        (progv '(foo) '(:progv) (foo-value))))
  (assert-eql :global foo)

  (makunbound 'foo)
  (assert-false (progn '(foo) '() (boundp 'foo)))

  (setf foo :global)
  (assert-false (progv '(foo) '() (boundp 'foo)))
  )

;;; test/progv.lt ends here.
